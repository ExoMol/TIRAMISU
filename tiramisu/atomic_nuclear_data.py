import re

# AME2012 nuclear mass data.

mass_data = {'1H': 1.00782503223, '2H': 2.01410177812, '3H': 3.01604927791, '4He': 4.00260325413, '3He': 3.01602932008,
             '7Li': 7.01600343659, '6Li': 6.01512288742, '9Be': 9.012183065, '10Be': 10.013534695, '7Be': 7.016928717,
             '11B': 11.009305355, '10B': 10.012936949, '12C': 12.0, '13C': 13.00335483507, '14C': 14.00324198843,
             '14N': 14.00307400443, '15N': 15.00010889888, '16O': 15.99491461957, '18O': 17.99915961286,
             '17O': 16.9991317565, '19F': 18.99840316273, '20Ne': 19.99244017617, '22Ne': 21.991385114,
             '21Ne': 20.993846685, '23Na': 22.98976928196, '22Na': 21.994437411, '24Mg': 23.985041697,
             '26Mg': 25.982592968, '25Mg': 24.985836976, '27Al': 26.981538531, '26Al': 25.986891904,
             '28Si': 27.97692653465, '29Si': 28.9764946649, '30Si': 29.973770136, '32Si': 31.974151539,
             '31P': 30.97376199842, '33P': 32.971725694, '32P': 31.973907643, '32S': 31.97207117441,
             '34S': 33.967867004, '33S': 32.97145890982, '36S': 35.967080706, '35S': 34.96903231, '35Cl': 34.968852682,
             '37Cl': 36.965902602, '36Cl': 35.968306809, '40Ar': 39.96238312372, '36Ar': 35.967545105,
             '38Ar': 37.962732106, '39Ar': 38.964313038, '42Ar': 41.963045736, '37Ar': 36.966776331,
             '39K': 38.96370648643, '41K': 40.96182525792, '40K': 39.963998166, '40Ca': 39.962590863,
             '44Ca': 43.955481561, '42Ca': 41.95861783, '48Ca': 47.952522765, '43Ca': 42.958766438,
             '46Ca': 45.953689023, '41Ca': 40.962277924, '45Ca': 44.95618635, '47Ca': 46.95454243, '45Sc': 44.955908275,
             '46Sc': 45.955168257, '47Sc': 46.95240374, '44m3Sc': 43.959402875, '48Sc': 47.952223611,
             '48Ti': 47.947941979, '46Ti': 45.952627718, '47Ti': 46.951758787, '49Ti': 48.947865676,
             '50Ti': 49.944786889, '44Ti': 43.959689949, '51V': 50.943957036, '50V': 49.947156014, '49V': 48.948511795,
             '48V': 47.952252223, '52Cr': 51.940506231, '53Cr': 52.940648147, '50Cr': 49.946041833,
             '54Cr': 53.938879158, '51Cr': 50.944765018, '55Mn': 54.93804391, '53Mn': 52.941288891,
             '54Mn': 53.940357615, '52Mn': 51.945563949, '56Fe': 55.934936326, '54Fe': 53.939608986,
             '57Fe': 56.935392841, '58Fe': 57.933274431, '60Fe': 59.9340711, '55Fe': 54.938291994, '59Fe': 58.934874338,
             '59Co': 58.933194288, '60Co': 59.933816299, '57Co': 56.936290574, '56Co': 55.939838798,
             '58Co': 57.935752073, '58Ni': 57.935342414, '60Ni': 59.930785885, '62Ni': 61.928345365,
             '61Ni': 60.93105557, '64Ni': 63.927966816, '59Ni': 58.934346202, '63Ni': 62.929669626,
             '56Ni': 55.942128549, '66Ni': 65.929139334, '57Ni': 56.939792184, '63Cu': 62.929597723,
             '65Cu': 64.927789704, '67Cu': 66.927730314, '64Zn': 63.929142013, '66Zn': 65.926033809,
             '68Zn': 67.924844554, '67Zn': 66.927127746, '70Zn': 69.925319208, '65Zn': 64.92924077,
             '72Zn': 71.926842807, '69Ga': 68.925573541, '71Ga': 70.924702577, '67Ga': 66.928202547,
             '74Ge': 73.921177761, '72Ge': 71.922075826, '70Ge': 69.92424875, '73Ge': 72.923458956,
             '76Ge': 75.921402726, '68Ge': 67.928095307, '71Ge': 70.924952327, '69Ge': 68.927964481,
             '75As': 74.921594567, '73As': 72.923829086, '74As': 73.923928598, '71As': 70.927113801,
             '77As': 76.920647563, '72As': 71.926752294, '76As': 75.922392015, '80Se': 79.916521762,
             '78Se': 77.91730928, '76Se': 75.919213704, '82Se': 81.916699497, '77Se': 76.919914154,
             '74Se': 73.922475934, '79Se': 78.918499287, '75Se': 74.92252287, '72Se': 71.927140507,
             '79Br': 78.918337579, '81Br': 80.91628969, '77Br': 76.921379198, '82Br': 81.916803246,
             '84Kr': 83.91149772816, '86Kr': 85.91061062693, '82Kr': 81.91348273, '83Kr': 82.914127164,
             '80Kr': 79.916378084, '78Kr': 77.920364944, '81Kr': 80.916591181, '85Kr': 84.912527262,
             '79Kr': 78.920082923, '85Rb': 84.9117897379, '87Rb': 86.909180531, '83Rb': 82.915114183,
             '84Rb': 83.914375229, '86Rb': 85.911167425, '88Sr': 87.905612542, '86Sr': 85.909260608,
             '87Sr': 86.908877531, '84Sr': 83.913419136, '90Sr': 89.907730037, '85Sr': 84.912932046,
             '89Sr': 88.907451095, '82Sr': 81.918399855, '83Sr': 82.917554374, '89Y': 88.905840348, '88Y': 87.909501563,
             '91Y': 90.907297442, '87Y': 86.910876138, '90Y': 89.907143942, '90Zr': 89.904697659, '94Zr': 93.906310828,
             '92Zr': 91.905034675, '91Zr': 90.905639587, '96Zr': 95.908271433, '93Zr': 92.906469947,
             '88Zr': 87.91022129, '95Zr': 94.90803853, '89Zr': 88.908881441, '93Nb': 92.906373004, '92Nb': 91.907188081,
             '94Nb': 93.907278836, '91Nb': 90.906989658, '93mNb': 92.906373004, '95Nb': 94.906832404,
             '95mNb': 94.906832404, '98Mo': 97.90540482, '96Mo': 95.904676115, '95Mo': 94.905838766,
             '92Mo': 91.906807959, '100Mo': 99.907471782, '97Mo': 96.906018118, '94Mo': 93.905084903,
             '93Mo': 92.906809577, '99Mo': 98.907708509, '97Tc': 96.906366706, '98Tc': 97.907212365,
             '99Tc': 98.906250844, '97mTc': 96.906366706, '95mTc': 94.907653612, '96Tc': 95.907868022,
             '102Ru': 101.904344096, '104Ru': 103.905427481, '101Ru': 100.905576872, '99Ru': 98.905934082,
             '100Ru': 99.904214256, '96Ru': 95.907590255, '98Ru': 97.905286813, '106Ru': 105.907329104,
             '103Ru': 102.906318627, '97Ru': 96.90754712, '103Rh': 102.905497993, '102mRh': 101.906837373,
             '101Rh': 100.906160613, '102Rh': 101.906837373, '99Rh': 98.908128239, '101mRh': 100.906160613,
             '105Rh': 104.905688549, '106Pd': 105.903480426, '108Pd': 107.90389164, '105Pd': 104.905079626,
             '110Pd': 109.905172199, '104Pd': 103.90403054, '102Pd': 101.905602187, '107Pd': 106.905128195,
             '103Pd': 102.906080949, '100Pd': 99.908504805, '107Ag': 106.905091611, '109Ag': 108.904755282,
             '108mAg': 107.905950346, '110m2Ag': 109.906110226, '105Ag': 104.906525615, '106mAg': 105.906663637,
             '111Ag': 110.905295923, '114Cd': 113.903365086, '112Cd': 111.902762868, '111Cd': 110.904182872,
             '110Cd': 109.903006606, '113Cd': 112.904408133, '116Cd': 115.904763148, '106Cd': 105.906459928,
             '108Cd': 107.90418344, '113mCd': 112.904408133, '109Cd': 108.904986653, '115mCd': 114.905437513,
             '115Cd': 114.905437513, '115In': 114.903878776, '113In': 112.904061839, '114mIn': 113.904917909,
             '111In': 110.905108458, '120Sn': 119.902201634, '118Sn': 117.901606574, '116Sn': 115.901742797,
             '119Sn': 118.903311172, '117Sn': 116.902953983, '124Sn': 123.905276645, '122Sn': 121.903443774,
             '112Sn': 111.904823874, '114Sn': 113.902782695, '115Sn': 114.903344699, '126Sn': 125.907658786,
             '121mSn': 120.904242554, '119mSn': 118.903311172, '123Sn': 122.905725221, '113Sn': 112.905175728,
             '117mSn': 116.902953983, '125Sn': 124.907786395, '121Sn': 120.904242554, '121Sb': 120.903811967,
             '123Sb': 122.904213204, '125Sb': 124.905253007, '124Sb': 123.905934978, '126Sb': 125.907252987,
             '120mSb': 119.905079385, '127Sb': 126.906924278, '122Sb': 121.905169948, '119Sb': 118.903945471,
             '130Te': 129.906222748, '126Te': 125.903310886, '125Te': 124.90442992, '124Te': 123.902817085,
             '122Te': 121.903043455, '123Te': 122.904269769, '120Te': 119.9040593, '128Te': 127.904461279,
             '121mTe': 120.904943812, '123mTe': 122.904269769, '127mTe': 126.905225735, '125mTe': 124.90442992,
             '129mTe': 128.90659646, '121Te': 120.904943812, '118Te': 117.905853629, '119mTe': 118.906407108,
             '132Te': 131.908546716, '131mTe': 130.908522213, '127I': 126.904471853, '129I': 128.904983669,
             '125I': 124.904629353, '126I': 125.905623329, '131I': 130.906126305, '124I': 123.906209041,
             '132Xe': 131.90415508563, '129Xe': 128.90478086113, '131Xe': 130.905084057, '134Xe': 133.905394664,
             '136Xe': 135.907214484, '130Xe': 129.903509349, '128Xe': 127.903531018, '124Xe': 123.905891984,
             '126Xe': 125.904298292, '127Xe': 126.905182914, '131mXe': 130.905084057, '129mXe': 128.90478086113,
             '133Xe': 132.905910751, '133mXe': 132.905910751, '133Cs': 132.905451961, '135Cs': 134.905977049,
             '137Cs': 136.907089231, '134Cs': 133.906718503, '136Cs': 135.907311358, '131Cs': 130.905464899,
             '132Cs': 131.906433914, '129Cs': 128.906065683, '138Ba': 137.905246995, '137Ba': 136.905827141,
             '136Ba': 135.904575727, '135Ba': 134.905688375, '134Ba': 133.904508182, '130Ba': 129.906320669,
             '132Ba': 131.905061128, '133Ba': 132.906007351, '140Ba': 139.91060573, '131Ba': 130.906940977,
             '128Ba': 127.908341967, '133mBa': 132.906007351, '135mBa': 134.905688375, '139La': 138.906356256,
             '138La': 137.907114919, '137La': 136.906450385, '140La': 139.909480635, '140Ce': 139.905443107,
             '142Ce': 141.909250375, '138Ce': 137.905991089, '136Ce': 135.907129205, '144Ce': 143.913652939,
             '139Ce': 138.906655111, '141Ce': 140.908280674, '134Ce': 133.908928142, '137mCe': 136.907762364,
             '143Ce': 142.91239212, '141Pr': 140.907657568, '143Pr': 142.910822796, '142Nd': 141.907728996,
             '144Nd': 143.910092974, '146Nd': 145.913122628, '143Nd': 142.909819989, '145Nd': 144.912579322,
             '148Nd': 147.916899294, '150Nd': 149.920902249, '147Nd': 146.916106136, '140Nd': 139.909549849,
             '145Pm': 144.912755935, '146Pm': 145.914702396, '147Pm': 146.915144988, '144Pm': 143.912596396,
             '143Pm': 142.910938262, '148mPm': 147.917481945, '148Pm': 147.917481945, '149Pm': 148.918342277,
             '151Pm': 150.921217539, '152Sm': 151.919739721, '154Sm': 153.922216861, '147Sm': 146.914904435,
             '149Sm': 148.917192062, '148Sm': 147.914829226, '150Sm': 149.917282919, '144Sm': 143.912006466,
             '146Sm': 145.913046991, '151Sm': 150.919939796, '145Sm': 144.913417339, '153Sm': 152.92210465,
             '153Eu': 152.921238003, '151Eu': 150.919857803, '150Eu': 149.919707671, '152Eu': 151.921752184,
             '154Eu': 153.922986962, '155Eu': 154.922901107, '149Eu': 148.917937763, '148Eu': 147.918089243,
             '147Eu': 146.916752659, '156Eu': 155.924760494, '145Eu': 144.916272629, '146Eu': 145.917211039,
             '158Gd': 157.924112348, '160Gd': 159.927062411, '156Gd': 155.922131241, '157Gd': 156.923968569,
             '155Gd': 154.922630473, '154Gd': 153.92087406, '152Gd': 151.919799494, '150Gd': 149.918664422,
             '148Gd': 147.918121511, '153Gd': 152.921758027, '151Gd': 150.92035595, '146Gd': 145.918318817,
             '149Gd': 148.919348117, '147Gd': 146.919101384, '159Tb': 158.92535471, '158Tb': 157.925420947,
             '157Tb': 156.924033028, '160Tb': 159.927175556, '161Tb': 160.927577825, '156Tb': 155.924755181,
             '155Tb': 154.923510547, '153Tb': 152.923442403, '156mTb': 155.924755181, '164Dy': 163.929181874,
             '162Dy': 161.926805573, '163Dy': 162.928738284, '161Dy': 160.926940492, '160Dy': 159.925204646,
             '158Dy': 157.924415875, '156Dy': 155.924284713, '154Dy': 153.924429277, '159Dy': 158.925746958,
             '166Dy': 165.932813863, '165Ho': 164.930328835, '163Ho': 162.928741027, '166mHo': 165.932290927,
             '166Ho': 165.932290927, '166Er': 165.93029953, '168Er': 167.932376688, '167Er': 166.932054617,
             '170Er': 169.93547023, '164Er': 163.929208791, '162Er': 161.928788364, '169Er': 168.93459685,
             '172Er': 171.939361858, '160Er': 159.92907713, '169Tm': 168.934217889, '171Tm': 170.936433871,
             '170Tm': 169.935806032, '168Tm': 167.934177409, '167Tm': 166.932856192, '172Tm': 171.938405521,
             '165Tm': 164.93244314, '174Yb': 173.938866437, '172Yb': 171.936385872, '173Yb': 172.938215136,
             '171Yb': 170.936330208, '176Yb': 175.942576447, '170Yb': 169.934766376, '168Yb': 167.933889602,
             '169Yb': 168.935182512, '175Yb': 174.941280797, '166Yb': 165.933874749, '175Lu': 174.940775191,
             '176Lu': 175.94268968, '174Lu': 173.940340854, '173Lu': 172.938934029, '177m3Lu': 176.943761525,
             '174mLu': 173.940340854, '171Lu': 170.93791696, '172Lu': 171.939089103, '177Lu': 176.943761525,
             '170Lu': 169.938478365, '169Lu': 168.937644149, '180Hf': 179.946557042, '178Hf': 177.943705833,
             '177Hf': 176.943227717, '179Hf': 178.945823212, '176Hf': 175.941407628, '174Hf': 173.940046141,
             '182Hf': 181.950561185, '178m2Hf': 177.943705833, '172Hf': 171.939449716, '175Hf': 174.941509187,
             '181Hf': 180.949108338, '179m2Hf': 178.945823212, '181Ta': 180.947995769, '180mTa': 179.947464832,
             '179Ta': 178.945936555, '182Ta': 181.950151853, '183Ta': 182.95137262, '177Ta': 176.944479469,
             '184W': 183.950930916, '186W': 185.954362771, '182W': 181.948203945, '183W': 182.950222748,
             '180W': 179.946710805, '181W': 180.948197783, '185W': 184.953418974, '188W': 187.958486177,
             '178W': 177.945883303, '187Re': 186.955750071, '185Re': 184.952954486, '186mRe': 185.954985595,
             '184mRe': 183.952522809, '183Re': 182.950819638, '186Re': 185.954985595, '182Re': 181.951209869,
             '189Re': 188.95922602, '192Os': 191.961476998, '190Os': 189.958443702, '189Os': 188.958144162,
             '188Os': 187.955835174, '187Os': 186.955747422, '186Os': 185.953835044, '184Os': 183.952488536,
             '194Os': 193.96517724, '185Os': 184.954041741, '191Os': 190.960926361, '193Os': 192.96414787,
             '193Ir': 192.962921587, '191Ir': 190.960589293, '192m2Ir': 191.962600247, '194m2Ir': 193.965073536,
             '192Ir': 191.962600247, '189Ir': 188.958715028, '190Ir': 189.960541215, '193mIr': 192.962921587,
             '188Ir': 187.958828095, '195Pt': 194.964791719, '194Pt': 193.96268085, '196Pt': 195.964952091,
             '198Pt': 197.96789492, '192Pt': 191.961038746, '190Pt': 189.959929707, '193Pt': 192.96298238,
             '188Pt': 187.959388889, '193mPt': 192.96298238, '195mPt': 194.964791719, '191Pt': 190.961672912,
             '202Pt': 201.975639, '197Au': 196.966568786, '195Au': 194.965035225, '196Au': 195.966569908,
             '199Au': 198.968765282, '198Au': 197.96824242, '198m2Au': 197.96824242, '194Au': 193.965417754,
             '202Hg': 201.9706434, '200Hg': 199.96832659, '199Hg': 198.968280643, '201Hg': 200.970302839,
             '198Hg': 197.966768602, '204Hg': 203.973493981, '196Hg': 195.96583256, '194Hg': 193.965449112,
             '203Hg': 202.972872837, '197Hg': 196.967212847, '195mHg': 194.96672054, '205Tl': 204.974427801,
             '203Tl': 202.972344593, '204Tl': 203.9738639, '202Tl': 201.972102441, '201Tl': 200.970822212,
             '200Tl': 199.970963258, '208Pb': 207.976652481, '206Pb': 205.974465683, '207Pb': 206.975897297,
             '204Pb': 203.973043981, '205Pb': 204.974482157, '202Pb': 201.972152026, '210Pb': 209.984188861,
             '203Pb': 202.973391126, '209Bi': 208.980399068, '210mBi': 209.984120705, '208Bi': 207.97974253,
             '207Bi': 206.978471022, '205Bi': 204.977386694, '206Bi': 205.978499317, '210Bi': 209.984120705,
             '209Po': 208.982430836, '208Po': 207.981246092, '210Po': 209.982874076, '206Po': 205.980473991,
             '222Rn': 222.017578246, '226Ra': 226.02541033, '228Ra': 228.031070728, '225Ra': 225.023611857,
             '223Ra': 223.018502327, '224Ra': 224.020211968, '227Ac': 227.027752283, '225Ac': 225.023229987,
             '226Ac': 226.026098383, '232Th': 232.03805576, '230Th': 230.03313413, '229Th': 229.031762713,
             '228Th': 228.028741272, '234Th': 234.043601407, '227Th': 227.027704227, '231Th': 231.036304628,
             '231Pa': 231.035884243, '233Pa': 233.040247222, '230Pa': 230.034541047, '229Pa': 229.032097236,
             '232Pa': 232.038591737, '238U': 238.050788423, '235U': 235.043930131, '234U': 234.040952306,
             '236U': 236.04556821, '233U': 233.039635525, '232U': 232.037156297, '230U': 230.033940096,
             '237U': 237.048730378, '231U': 231.036293861, '237Np': 237.048173649, '236Np': 236.046569744,
             '235Np': 235.044063487, '234Np': 234.042895256, '239Np': 239.052939241, '238Np': 238.050946611,
             '244Pu': 244.06420526, '242Pu': 242.058742809, '239Pu': 239.052163591, '240Pu': 240.05381375,
             '238Pu': 238.049560111, '241Pu': 241.056851661, '236Pu': 236.046058109, '237Pu': 237.04840983,
             '246Pu': 246.070205458, '247Pu': 247.07419, '243Am': 243.061381302, '241Am': 241.056829349,
             '242mAm': 242.059549364, '240Am': 240.055300384, '247Cm': 247.070354131, '248Cm': 248.072349862,
             '245Cm': 245.065491454, '250Cm': 250.078358313, '246Cm': 246.067223841, '243Cm': 243.061389325,
             '244Cm': 244.062752783, '242Cm': 242.058836039, '241Cm': 241.05765317, '240Cm': 240.055529681,
             '252Cm': 252.08487, '247Bk': 247.070307302, '248Bk': 248.073088, '249Bk': 249.074987676,
             '245Bk': 245.066361821, '246Bk': 246.068673126, '251Cf': 251.079588625, '249Cf': 249.074853903,
             '250Cf': 250.076406244, '252Cf': 252.081627199, '248Cf': 248.072185066, '254Cf': 254.087324263,
             '253Cf': 253.085134499, '246Cf': 246.068805531, '252Es': 252.082979865, '254Es': 254.088022199,
             '255Es': 255.090274958, '253Es': 253.084825715, '257Es': 257.095979, '254mEs': 254.088022199,
             '251Es': 251.079993586, '257Fm': 257.095106078, '253Fm': 253.085184571, '252Fm': 252.08246706,
             '258Md': 258.098431496, '260Md': 260.103653, '268Db': 268.125671}

default_isotope = {'H': '1H', 'He': '3He', 'Li': '6Li', 'Be': '7Be', 'B': '10B', 'C': '12C', 'N': '14N', 'O': '16O',
                   'F': '19F', 'Ne': '20Ne', 'Na': '22Na', 'Mg': '24Mg', 'Al': '26Al', 'Si': '28Si', 'P': '31P',
                   'S': '32S', 'Cl': '35Cl', 'Ar': '36Ar', 'K': '39K', 'Ca': '40Ca', 'Sc': '45Sc', 'mSc': '44m3Sc',
                   'Ti': '44Ti', 'V': '48V', 'Cr': '50Cr', 'Mn': '52Mn', 'Fe': '54Fe', 'Co': '56Co', 'Ni': '56Ni',
                   'Cu': '63Cu', 'Zn': '64Zn', 'Ga': '67Ga', 'Ge': '68Ge', 'As': '71As', 'Se': '72Se', 'Br': '77Br',
                   'Kr': '78Kr', 'Rb': '83Rb', 'Sr': '82Sr', 'Y': '87Y', 'Zr': '88Zr', 'Nb': '91Nb', 'mNb': '93mNb',
                   'Mo': '92Mo', 'Tc': '96Tc', 'mTc': '95mTc', 'Ru': '96Ru', 'Rh': '99Rh', 'mRh': '101mRh',
                   'Pd': '100Pd', 'Ag': '105Ag', 'mAg': '106mAg', 'Cd': '106Cd', 'mCd': '113mCd', 'In': '111In',
                   'mIn': '114mIn', 'Sn': '112Sn', 'mSn': '117mSn', 'Sb': '119Sb', 'mSb': '120mSb', 'Te': '118Te',
                   'mTe': '119mTe', 'I': '124I', 'Xe': '124Xe', 'mXe': '129mXe', 'Cs': '129Cs', 'Ba': '128Ba',
                   'mBa': '133mBa', 'La': '137La', 'Ce': '134Ce', 'mCe': '137mCe', 'Pr': '141Pr', 'Nd': '140Nd',
                   'Pm': '143Pm', 'mPm': '148mPm', 'Sm': '144Sm', 'Eu': '145Eu', 'Gd': '146Gd', 'Tb': '153Tb',
                   'mTb': '156mTb', 'Dy': '154Dy', 'Ho': '163Ho', 'mHo': '166mHo', 'Er': '160Er', 'Tm': '165Tm',
                   'Yb': '166Yb', 'Lu': '169Lu', 'mLu': '174mLu', 'Hf': '172Hf', 'mHf': '178m2Hf', 'Ta': '177Ta',
                   'mTa': '180mTa', 'W': '178W', 'Re': '182Re', 'mRe': '184mRe', 'Os': '184Os', 'Ir': '188Ir',
                   'mIr': '193mIr', 'Pt': '188Pt', 'mPt': '193mPt', 'Au': '194Au', 'mAu': '198m2Au', 'Hg': '194Hg',
                   'mHg': '195mHg', 'Tl': '200Tl', 'Pb': '202Pb', 'Bi': '205Bi', 'mBi': '210mBi', 'Po': '206Po',
                   'Rn': '222Rn', 'Ra': '223Ra', 'Ac': '225Ac', 'Th': '227Th', 'Pa': '229Pa', 'U': '230U',
                   'Np': '234Np', 'Pu': '236Pu', 'Am': '240Am', 'mAm': '242mAm', 'Cm': '240Cm', 'Bk': '245Bk',
                   'Cf': '246Cf', 'Es': '251Es', 'mEs': '254mEs', 'Fm': '252Fm', 'Md': '258Md', 'Db': '268Db'}


def get_mass(symbol: str) -> float:
    """
    Get the mass of a single element in Daltons.

    Parameters
    ----------
    symbol:
        Atomic symbol.

    Returns
    -------
        Mass in Daltons.

    """
    # Handle plain element (no isotope number)
    if symbol in default_isotope:
        symbol = default_isotope[symbol]
    if symbol not in mass_data:
        raise KeyError(f"Isotope '{symbol}' not found in dataset.")
    return mass_data[symbol]


def list_isotopes(element: str):
    """Return all isotopes available for a given element (e.g. 'C')."""
    return [k for k in mass_data.keys() if k.endswith(element)]


def get_molecular_mass(formula: str) -> float:
    """
    Calculates the mass of an input molecule chemical formula (e.g. 'H2O', 'TiO2').
    Supports isotopic notation like '13CO2' or mixed (e.g., '12C16O').

    Parameters
    ----------
    formula:
        Input molecule formula.

    Returns
    -------
        Total mass in Daltons.

    """
    if re.search(r'\d+[A-Z][a-z]?\d+[A-Z]', formula):
        raise ValueError(
            f"Ambiguous formula '{formula}'. Use delimiters like '12C-2H' or '13C-16O' to clarify isotopes."
        )

    def parse_segment(segment: str) -> float:
        """Parse a simple segment without parentheses and sum isotope masses."""
        total = 0.0
        pattern = r'(\d*[A-Z][a-z]?)(\d*)'  # isotope prefix or normal element with count
        tokens = re.findall(pattern, segment)
        for (symbol, count_str) in tokens:
            count = int(count_str) if count_str else 1
            total += get_mass(symbol) * count
        return total

    total_mass = 0.0

    # --- Handle parentheses recursively ---
    while '(' in formula:
        match = re.search(r"\(([^\(\)]+)\)(\d*)", formula)
        if not match:
            break
        inner, multiplier_str = match.groups()
        multiplier = int(multiplier_str) if multiplier_str else 1
        inner_mass = parse_segment(inner) * multiplier
        total_mass += inner_mass
        # Replace this group with a pseudo-element marker that carries numeric value
        formula = formula[:match.start()] + formula[match.end():]

    # --- Parse remaining parts ---
    parts = re.findall(r"(\d*[A-Z][a-z]?|\d*\.\d+X)(\d*)", formula)
    for (part, count_str) in parts:
        count = int(count_str) if count_str else 1
        if part.endswith("X"):
            total_mass += float(part[:-1]) * count
        else:
            total_mass += get_mass(part) * count
    return total_mass
